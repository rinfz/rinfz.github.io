<!DOCTYPE html>
<html lang="en" class="astro-SCKKX6R4">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <meta name="description" content="Personal website of Matt R: programming, music, tech, bird watching and other interests">
        <link rel="icon" type="image/x-icon" href="/images/favicon.png">
        <title>Barely Laughing - b5 version 3 (in nim)</title>
    <link rel="stylesheet" href="/_astro/birds.a42b81e3.css" />
<link rel="stylesheet" href="/_astro/asm-collatz.d84417d5.css" />
<link rel="stylesheet" href="/_astro/asm-collatz.8c1b21d6.css" />
<link rel="stylesheet" href="/_astro/asm-collatz.417652d1.css" /></head>

    <body class="astro-SCKKX6R4">
        <div class="max-w-5xl min-h-screen w-full px-5 pb-0 sm:pb-5 astro-SCKKX6R4">
            <header class="bg-gradient-to-t from-gray-900 to-gray-8 00 text-center py-10 border border-gray-700 text-white mb-2.5 mt-2.5 text-sm font-semibold astro-SCKKX6R4">
                <h1 class="astro-SCKKX6R4"><a href="/" class="astro-SCKKX6R4">A Delightful Abstraction</a></h1>
            </header>

            <main class="flex flex-col md:flex-row gap-x-4 astro-SCKKX6R4">
                <nav class="w-full flex-none md:w-1/5 mb-2 astro-SCKKX6R4">
                    <ul id="nav-items" class="hidden md:block space-y-1 mb-3 astro-SCKKX6R4">
                        <li class="astro-SCKKX6R4"><a class="block w-full text-center md:text-left bg-orange-600 px-1 py-2 hover:bg-orange-500 astro-SCKKX6R4" href="/">Home</a></li>
                        <li class="astro-SCKKX6R4"><a class="block w-full text-center md:text-left bg-orange-600 px-1 py-2 hover:bg-orange-500 astro-SCKKX6R4" href="/posts">Posts</a></li>
                        <li class="astro-SCKKX6R4"><a class="block w-full text-center md:text-left bg-orange-600 px-1 py-2 hover:bg-orange-500 astro-SCKKX6R4" href="/birds">Bird List</a></li>
                        <li class="astro-SCKKX6R4">
                            <a class="block w-full text-center md:text-left bg-orange-600 px-1 py-2 hover:bg-orange-500 astro-SCKKX6R4" href="/photos">Photography</a>
                        </li>
                        <li class="astro-SCKKX6R4">
                            <a class="block w-full text-center md:text-left bg-orange-600 px-1 py-2 hover:bg-orange-500 astro-SCKKX6R4" href="https://larusreader.com/" target="_blank">Online Reading App</a>
                        </li>
                        <li class="astro-SCKKX6R4">
                            <a class="block w-full text-center md:text-left bg-orange-600 px-1 py-2 hover:bg-orange-500 astro-SCKKX6R4" href="https://www.goodreads.com/review/list/164595825-matt-r?order=d&shelf=read&sort=date_updated" target="_blank">
                                My Goodreads
                            </a>
                        </li>
                    </ul>

                    <div class="flex md:block justify-between md:justify-items-start items-center md:items-start astro-SCKKX6R4">
                        <p class="text-xs astro-SCKKX6R4">
                            <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" class="astro-SCKKX6R4">&copy; CC BY-SA 4.0</a>
                        </p>
                        <button class="block md:hidden astro-SCKKX6R4" id="toggle-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 astro-SCKKX6R4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" class="astro-SCKKX6R4"></path>
                            </svg>
                        </button>
                    </div>
                </nav>

                <div class="main-w flex-1 astro-SCKKX6R4">
                    
  <article class="text-justify astro-GVPN4U4B">
    <h2 class="astro-GVPN4U4B">b5 version 3 (in nim)</h2>
    <p class="pt-0 astro-GVPN4U4B">2021-01-14</p>
    <p>Another installment in the long line of barely laughing websites has arrived - version three! This one
is build with a brand spanking (170 ish line) static site generator written in my chosen lang du jour: <a href="https://nim-lang.org/">nim</a>.
I’m looking to get as much experience with nim as possible since I’m planning on undertaking a larger
project using it shortly in the future.</p>
<p>Along with chat bots (the kind that run on chat protocols and in chatrooms for amusement purposes), static
site generators are one of my favourite projects to go to when checking out a new language. You have a
very clear goal to achieve and one which can be completed in a short amount of time because the bare minimum
scope of a static website is essentially just writing text to files. It’s one of those projects that has
a nice and visual outcome and you get a good kick out of having a website like this to boot.</p>
<p>Nim comes with a batteries included stdlib akin to python (though in my opinion - better). This contrast
is a welcome one coming from D (which version 2 of this website was written in). Basically it made getting
up and running a breeze without having to look to far for 3rd party libraries (even though that’s also
easy with nim). The stdlib is well documented as you would expect for a language of this size, but it is
still welcome either way.</p>
<p>I decided to use a mild alteration to markdown for post files by adding tags marked with an <code>@</code> symbol.
These are both used for including metadata in posts such as the title and date which they were written,
and also for including code snippets. Even though it’s simple, I still found the code for preprocessing
the posts to be quite succinct. It runs a scan over every line in the md post files looking for these tags
and either extracts the data or in the case of snippets, finds the relevant file and inserts it. This
gives the benefit of having snippets being implemented as proper source files and having them be runnable
as standalone files/scripts/apps etc. as well as keeping the code nicely decoupled from the articles themselves.</p>
<p>Here is the snippet for preprocessing the files:</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">proc</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">parseSnippet</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">discard</span><span style="color: #E1E4E8">  </span><span style="color: #6A737D"># omitted for the purposes of the post</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">proc</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">processPost</span><span style="color: #E1E4E8">(path</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">string</span><span style="color: #E1E4E8">)</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">Post</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #6A737D"># posts have their own dir and the text for each is always in post.md</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">for</span><span style="color: #E1E4E8"> line </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">lines</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">joinPath</span><span style="color: #E1E4E8">(path, </span><span style="color: #9ECBFF">"post.md"</span><span style="color: #E1E4E8">))</span><span style="color: #F97583">:</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> tag, tagBody</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">string</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> line</span><span style="color: #F97583">.</span><span style="color: #79B8FF">scanf</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"@$w $*"</span><span style="color: #E1E4E8">, tag, tagBody)</span><span style="color: #F97583">:</span><span style="color: #E1E4E8">  </span><span style="color: #6A737D"># scan each line in the post looking for @&#x3C;tag></span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #F97583">case</span><span style="color: #E1E4E8"> tag</span><span style="color: #F97583">:</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">of</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"title"</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #6A737D"># matches @title</span></span>
<span class="line"><span style="color: #E1E4E8">          result</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">header</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">title </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> tagBody</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">of</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"date"</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #6A737D"># similar</span></span>
<span class="line"><span style="color: #E1E4E8">          result</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">header</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">date </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> tagBody</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">of</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"snippet"</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #6A737D"># similar</span></span>
<span class="line"><span style="color: #E1E4E8">          result</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">body </span><span style="color: #F97583">&#x26;=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">parseSnippet</span><span style="color: #E1E4E8">(path, tagBody)</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">else:</span></span>
<span class="line"><span style="color: #E1E4E8">          </span><span style="color: #79B8FF">doAssert</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">false</span><span style="color: #E1E4E8">, </span><span style="color: #9ECBFF">"unknown tag: "</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;</span><span style="color: #E1E4E8"> tag)</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">else:</span></span>
<span class="line"><span style="color: #E1E4E8">      result</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">body </span><span style="color: #F97583">&#x26;=</span><span style="color: #E1E4E8"> line </span><span style="color: #F97583">&#x26;</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'</span><span style="color: #79B8FF">\n</span><span style="color: #9ECBFF">'</span></span></code></pre>
<p>I feel that the case statement for each type of tag skips a lot of the line noise you tend to get with
either <code>switch</code> statements (<code>break</code>) or the monolith of <code>if</code>/<code>else</code> statements you get in python.</p>
<p><code>result</code> is implicitly created in procs which have a return type. This allows you to skip the “boilerplate”
of initialising a result variable in every function - it’s not much but I quite like it. You can overwrite
the result variable by introducing it as a <code>let</code> or <code>var</code> binding though, if you desire.</p>
<p>Anyway, that’s enough rambling but basically, nim is pretty nice and a bit of fresh air compared to D (which
I’ve been writing on and off for about 6 years now). I’ve got what seems to have the potential to be
a nice setup with nim in another project that I’ll talk about some other time, but I’m feeling hopeful. And
it was cool to get all of this done in an evening too!</p>
  </article>

                </div>
            </main>
        </div>

        <script type="text/javascript">
            const button = document.getElementById("toggle-btn");
            const navItems = document.getElementById("nav-items");

            button.addEventListener('click', () => {
                navItems.classList.toggle('hidden');
                if (navItems.classList.contains('hidden')) {
                    button.innerHTML =
                        '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg>';
                } else {
                    button.innerHTML =
                        '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>';
                }
            });
        </script>
    </body>
</html>